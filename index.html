<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Attendance Calculator</title>
<style>
  body {
    background-color: black;
    color: yellow;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input[type="text"],
  input[type="number"] {
    padding: 5px;
    font-size: 1em;
    margin-top: 5px;
    width: 200px;
    background-color: #222;
    border: 1px solid yellow;
    color: yellow;
  }
  button {
    background-color: yellow;
    color: black;
    border: none;
    padding: 10px 15px;
    margin-top: 15px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background-color: #e6cc00;
  }
  #studentList {
    margin-top: 20px;
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid yellow;
    padding: 10px;
  }
  .student-entry {
    border-bottom: 1px solid yellow;
    padding: 5px 0;
  }
  #output {
    margin-top: 20px;
    white-space: pre-wrap;
    border: 1px solid yellow;
    padding: 10px;
    max-height: 200px;
    overflow-y: auto;
  }
</style>
</head>
<body>

<h1>Attendance Calculator</h1>

<div>
  <label for="studentName">Student Name:</label>
  <input type="text" id="studentName" placeholder="Enter name" />
  
  <label for="daysAttended">Days Attended:</label>
  <input type="number" id="daysAttended" min="0" max="100" placeholder="Enter days attended" />
  
  <button id="addUpdateBtn">Add/Update Student</button>
</div>

<div id="studentList"></div>

<button id="calculateBtn">Calculate Bunk Days</button>

<div id="output"></div>

<div style="margin-top:20px;">
  <button id="saveBtn">Save Data</button>
  <button id="loadBtn">Load Data</button>
  <input type="file" id="fileInput" style="display:none;" accept=".json" />
</div>

<script>
  const ATTENDANCE_THRESHOLD = 75;  // percent
  const TOTAL_DAYS = 100;

  let students = {};  // {name: daysAttended}

  const studentListDiv = document.getElementById('studentList');
  const outputDiv = document.getElementById('output');
  const nameInput = document.getElementById('studentName');
  const daysInput = document.getElementById('daysAttended');
  const addUpdateBtn = document.getElementById('addUpdateBtn');
  const calculateBtn = document.getElementById('calculateBtn');
  const saveBtn = document.getElementById('saveBtn');
  const loadBtn = document.getElementById('loadBtn');
  const fileInput = document.getElementById('fileInput');

  function refreshStudentList() {
    studentListDiv.innerHTML = '';
    const sortedNames = Object.keys(students).sort();
    if (sortedNames.length === 0) {
      studentListDiv.textContent = 'No students added yet.';
      return;
    }
    sortedNames.forEach(name => {
      const days = students[name];
      const percent = ((days / TOTAL_DAYS) * 100).toFixed(2);
      const div = document.createElement('div');
      div.className = 'student-entry';
      div.textContent = `${name}: ${days} days attended (${percent}%)`;
      studentListDiv.appendChild(div);
    });
  }

  addUpdateBtn.onclick = () => {
    const name = nameInput.value.trim();
    const days = parseInt(daysInput.value);

    if (!name) {
      alert('Please enter a student name.');
      return;
    }
    if (isNaN(days) || days < 0 || days > TOTAL_DAYS) {
      alert(`Please enter valid days attended (0 - ${TOTAL_DAYS}).`);
      return;
    }

    students[name] = days;
    refreshStudentList();

    nameInput.value = '';
    daysInput.value = '';
  };

  calculateBtn.onclick = () => {
    if (Object.keys(students).length === 0) {
      alert('No student data available.');
      return;
    }
    let result = '';
    for (const [name, days] of Object.entries(students).sort()) {
      const percent = (days / TOTAL_DAYS) * 100;
      if (percent < ATTENDANCE_THRESHOLD) {
        result += `${name}: Below attendance threshold! Cannot bunk.\n`;
      } else {
        const maxBunk = Math.floor(days - (ATTENDANCE_THRESHOLD / 100) * TOTAL_DAYS);
        const bunk = maxBunk >= 0 ? maxBunk : 0;
        result += `${name}: Can bunk ${bunk} day(s).\n`;
      }
    }
    outputDiv.textContent = result;
  };

  saveBtn.onclick = () => {
    if (Object.keys(students).length === 0) {
      alert('No data to save.');
      return;
    }
    const dataStr = JSON.stringify(students, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'attendance_data.json';
    a.click();
    URL.revokeObjectURL(url);
  };

  loadBtn.onclick = () => {
    fileInput.click();
  };

  fileInput.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (evt) => {
      try {
        const loadedData = JSON.parse(evt.target.result);
        // Validate loaded data
        if (typeof loadedData === 'object' && loadedData !== null) {
          students = {};
          for (const [key, value] of Object.entries(loadedData)) {
            if (typeof key === 'string' && Number.isInteger(value) && value >= 0 && value <= TOTAL_DAYS) {
              students[key] = value;
            }
          }
          refreshStudentList();
          outputDiv.textContent = 'Data loaded successfully.';
        } else {
          throw new Error('Invalid data format');
        }
      } catch (err) {
        alert('Failed to load data: ' + err.message);
      }
    };
    reader.readAsText(file);
    fileInput.value = ''; // reset file input
  };

  // Initialize list
  refreshStudentList();
</script>

</body>
</html>
